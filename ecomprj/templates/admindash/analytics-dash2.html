<!-- In your analytics-dash2.html template -->
{% extends 'admindash/base-dash.html' %}
{% load static %}
{% block content %}       
    {% load humanize %}
    {% load custom_filters %}

    <main>
        <!-- Add any necessary styling or structure here -->

        <div class="analytics-section">
            <h2>Most Ordered Product Types by Month</h2>

            {% for month_data in monthly_data %}
                <h1 style="color:#72bcd4">{{ month_data.month|date:"F Y" }}</h1>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Product Type |</th>
                                <th> Total Orders |</th>
                                <th> Total Quantity</th>
                            </tr>
                        </thead>
                        <tbody>
                                {% for product_type_data in month_data.data %}
                                    <tr>
                                        <td><a href="{% url 'core:most_ordered_materials_per_month' product_type=product_type_data.product_type__name %}"  class="primary">{{ product_type_data.product_type__name }}</a></td>

                                        <td>{{ product_type_data.total_orders }}</td>
                                        <td>{{ product_type_data.total_quantity }}</td>
                                    </tr>
                                {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- Add a canvas for the chart -->
                <canvas id="myChart{{ forloop.counter }}" width="400" height="200"></canvas>
                <script>
                    var ctx = document.getElementById('myChart{{ forloop.counter }}').getContext('2d');
                    var myChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: [{% for product_type in month_data.data %}"{{ product_type.product_type__name }}",{% endfor %}],
                            datasets: [{
                                label: 'Total Orders',
                                data: [{% for product_type in month_data.data %}{{ product_type.total_orders }},{% endfor %}],
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                borderColor: 'rgba(75, 192, 192, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                </script>
            {% endfor %}
        </div>


        <div class="analytics-section">
            <h2>Most Ordered Product Types by Month</h2>

            <!-- Create a canvas for the chart -->
            <canvas id="myChart" width="800" height="400"></canvas>
            <script>
                var ctx = document.getElementById('myChart').getContext('2d');
                var myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: [{% for month_data in monthly_data %}"{{ month_data.month|date:"F Y" }}",{% endfor %}],
                        datasets: [
                            {% for month_data in monthly_data %}
                            {
                                label: '{{ month_data.month|date:"F Y" }}',
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                borderColor: 'rgba(75, 192, 192, 1)',
                                borderWidth: 1,
                                data: [{% for product_type_data in month_data.data %}{{ product_type_data.total_orders }},{% endfor %}]
                            },
                            {% endfor %}
                        ]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            </script>
        </div> 

        <!-- ... (existing code) -->
        
    </main>
{% endblock content %}
