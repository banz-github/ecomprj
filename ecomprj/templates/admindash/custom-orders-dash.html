{% extends 'admindash/base-dash.html' %}
{% load static %}
{% block content %}       
{% load humanize %}
{% load custom_filters %}

        <main>
            <div class="date">
                <form method="GET">
                    <label for="datePicker">Select Date:</label>
                    <input type="date" id="dateFilter" name="selected_date">
                    <input type="submit" value="Apply">
                </form>
            </div>
            <!-- END OF INSIGHTS -->
            <div class="recent-orders">
                <h2>Custom Orders</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Customer Name</th>
                                <th>Custom Order ID</th>
                                <th>Product Type</th>
                                <th>Material</th>
                                <th>Color</th>
                                <th>Foam Type</th>
                                <th>M/R</th>
                                <th>Quantity</th>
                                <th>Payment Approved</th>
                                <th>Percentage</th>
                                <th>Receipt Submitted</th>
                                {% comment %} <th>With Downpayment</th> {% endcomment %}
                                <th>Paid Amount</th>
                                <th>Date Approved</th>
                                <th>Verifier</th>


                            </tr>
                            
                        </thead>
                        <tbody>
                            {% for col in custom_order_list %}
                            <tr>
                                <td data-date="{{ col.date_approved }}">{{col.profile}}</td>
                                <td data-date="{{ col.date_approved }}">{{col.co_id}}</td>
                                <td data-date="{{ col.date_approved }}"><a href="{% url 'core:most_ordered_materials' product_type=col.product_type %}" class="primary">{{col.product_type}}</a></td>
                                <td data-date="{{ col.date_approved }}">{{col.material|title}}</td>
                                <td data-date="{{ col.date_approved }}">{{col.color|title}}</td>
                                <td data-date="{{ col.date_approved }}">{{col.foam_type|title}}</td>
                                <td data-date="{{ col.date_approved }}">{{col.make_or_repair|title}}</td>
                                <td data-date="{{ col.date_approved }}">{{col.qty|title}}</td>
                                {% if col.with_downpayment == True %}
                                <td data-date="{{ col.date_approved }}"><i class="fas fa-check-circle text-success">✔️</i></td>
                                {% else %}
                                <td data-date="{{ col.date_approved }}" class="text-danger"><strong>X</strong></td>
                                {% endif %}
                                <td data-date="{{ col.date_approved }}">{{col.percentage_progress}}%</td>

                                {% if col.receipt_submitted == True %}
                                <td data-date="{{ col.date_approved }}"><i class="fas fa-check-circle text-success">✔️</i></td>
                                {% else %}
                                <td data-date="{{ col.date_approved }}" class="text-danger"><strong>X</strong></td>
                                {% endif %}
                                <td data-date="{{ col.date_approved }}">₱{{col.paid_amount}}</td>
                                <th data-date="{{ col.date_approved }}">{{col.date_approved}}</th>

                                <th data-date="{{ col.date_approved }}">{{col.admin_profile}}</th>

                                <td><a href="{% url 'core:custom_order_detail_dashboard' co_id=col.co_id %}" class="primary">View</a></td>
                                {% comment %} <td><a href="{% url 'core:order-detail' o.id %}" class="btn-small d-block">View</a></td>

                                <td class="warning">Pending</td>
                                <td class="primary">Details</td> {% endcomment %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% comment %} <a href="#"  id="show-all-orders">Show All</a> <!-- self suggestion doblehin ung page--> {% endcomment %}

                {% comment %} <div class="table-container">
                    <table>
                    <!-- here is where we will put the canvas, also include JS code to your response --> 
                        <canvas style="height:50px;" id="adminChart"></canvas>
                        <script>
                            const adminLabels = {{ month|safe }};
                            
                            const adminData = {
                                labels: adminLabels,
                                datasets: [{
                                    label: 'Total orders in each month',
                                    backgroundColor: 'rgb(59, 183, 126)',
                                    borderColor: 'rgb(59, 183, 126)',
                                    data: {{ total_orders|safe }}
                                }],
                            };
                        
                            const adminConfig = {
                                type: 'bar',
                                data: adminData,
                                options: {
                                    tooltips: { enabled: false },
                                    hover: { mode: null },
                                }
                            };
                        
                            const adminChart = new Chart(
                                document.getElementById('adminChart'),
                                adminConfig
                            );
                        </script>
                    </table>
                    
                </div> {% endcomment %}

                {% comment %} <div class="table-container">
                    <table>
                        <canvas style="height:50px;" id="adminCategoryChart"></canvas>
                        <script>
                            const categoryLabels = {{ category_labels|safe }};
                            
                            const categoryData = {
                                labels: categoryLabels,
                                datasets: [{
                                    label: 'Orders by Category',
                                    backgroundColor: [
                                        'rgb(255, 99, 132)',
                                        'rgb(255, 205, 86)',
                                        'rgb(54, 162, 235)',
                                        // Add more colors as needed
                                    ],
                                    borderColor: 'white',
                                    borderWidth: 2,
                                    data: {{ category_data|safe }}
                                }]
                            };

                            const categoryConfig = {
                                type: 'pie',
                                data: categoryData,
                                label: 'Orders by Category',
                                options: {
                                    tooltips: {
                                        callbacks: {
                                            label: function (tooltipItem, data) {
                                                return data.labels[tooltipItem.index] + ': ' + data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                                            }
                                        }
                                    },
                                    hover: { mode: null },
                                }
                            };

                            const categoryChart = new Chart(
                                document.getElementById('adminCategoryChart'),
                                categoryConfig
                            );
                        </script>

                    </table>
                </div> {% endcomment %}

            </div>

            <br>
            <!-- ... (existing code) -->
            <div class="analytics-section">
                <h2>Most Ordered Product Types</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Product Type</th>
                                <th>Total Quantity</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for product_type in most_ordered_product_types %}
                            <tr>
                                <td data-date="{{ product_type.date_approved }}">{{ product_type.product_type__name }} PT</td>
                                <td data-date="{{ product_type.date_approved }}">{{ product_type.total_quantity }} QTY</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            

        <!-- ... (existing code) -->    
        <!-- ... (existing code) -->
<!-- ... (existing code) -->

<div class="bar-graph-container">
    <canvas style="height:300px;" id="productTypeBarGraph"></canvas>
</div>
<!-- ... (existing code) -->
<div class="bar-graph-container">
    <canvas style="height:300px;" id="productTypeBarGraph"></canvas>
    {% comment %} <script>
        const productTypeData = {
            labels: [{% for product_type in most_ordered_product_types %}"{{ product_type.product_type__name }}",{% endfor %}],
            datasets: [{
                label: 'Total Quantity for Each Product Type',
                backgroundColor: [{% for product_type in most_ordered_product_types %}'{{ product_type|random_color }}',{% endfor %}],
                borderColor: [{% for product_type in most_ordered_product_types %}'{{ product_type|random_color }}',{% endfor %}],
                borderWidth: 1,
                data: [{% for product_type in most_ordered_product_types %}{{ product_type.total_quantity }},{% endfor %}]
            }]
        };

        const productTypeConfig = {
            type: 'bar',
            data: productTypeData,
            options: {
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Product Type'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Total Quantity'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false, // Set to false to hide the legend
                    }
                }
            }
        };

        const productTypeBarGraph = new Chart(
            document.getElementById('productTypeBarGraph'),
            productTypeConfig
        );


        

    </script> {% endcomment %}
    <script>
        document.getElementById('dateFilter').addEventListener('change', function() {
            // Get the selected date
            const selectedDate = this.value;
    
            // Filter orders based on the selected date
            filterByDate('.recent-orders tbody tr', selectedDate);
    
            // Filter most ordered product types
            filterByDate('.analytics-section tbody tr', selectedDate);
    
            // Show or hide "all-time" based on the selected date
            const allTimeSections = document.querySelectorAll('.analytics-section');
            allTimeSections.forEach(function(section) {
                const hasSelectedDate = selectedDate !== '';
                if (hasSelectedDate) {
                    section.style.display = 'none';
                } else {
                    section.style.display = 'block';
                }
            });
    
            // Update the most-ordered product types chart based on the selected date
            const newProductTypeData = {
                labels: [{% for product_type in most_ordered_product_types %}"{{ product_type.product_type__name }}",{% endfor %}],
                datasets: [{
                    label: 'Total Quantity for Each Product Type',
                    backgroundColor: [{% for product_type in most_ordered_product_types %}'{{ product_type|random_color }}',{% endfor %}],
                    borderColor: [{% for product_type in most_ordered_product_types %}'{{ product_type|random_color }}',{% endfor %}],
                    borderWidth: 1,
                    data: [{% for product_type in most_ordered_product_types %}{{ product_type.total_quantity }},{% endfor %}]
                }]
            };
    
            productTypeBarGraph.data = newProductTypeData;
            productTypeBarGraph.update();
        });
    
        // Function to filter elements by date
        function filterByDate(selector, selectedDate) {
            const elements = document.querySelectorAll(selector);
            elements.forEach(function(element) {
                const elementDate = element.querySelector('td[data-date]').getAttribute('data-date');
                if (selectedDate === '' || selectedDate === elementDate) {
                    element.style.display = '';
                } else {
                    element.style.display = 'none';
                }
            });
        }
    
        // Existing code for productTypeBarGraph
        const productTypeData = {
            labels: [{% for product_type in most_ordered_product_types %}"{{ product_type.product_type__name }}",{% endfor %}],
            datasets: [{
                label: 'Total Quantity for Each Product Type',
                backgroundColor: [{% for product_type in most_ordered_product_types %}'{{ product_type|random_color }}',{% endfor %}],
                borderColor: [{% for product_type in most_ordered_product_types %}'{{ product_type|random_color }}',{% endfor %}],
                borderWidth: 1,
                data: [{% for product_type in most_ordered_product_types %}{{ product_type.total_quantity }},{% endfor %}]
            }]
        };
    
        const productTypeConfig = {
            type: 'bar',
            data: productTypeData,
            options: {
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Product Type'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Total Quantity'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false, // Set to false to hide the legend
                    }
                }
            }
        };
    
        const productTypeBarGraph = new Chart(
            document.getElementById('productTypeBarGraph'),
            productTypeConfig
        );
    </script>
    
    
    
    
    
</div>







        </main>

        {% endblock content %}
