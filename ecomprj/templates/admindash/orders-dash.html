{% extends 'admindash/base-dash.html' %}
{% load static %}
{% block content %}       
{% load humanize %}
        <main>
            <!-- END OF INSIGHTS -->
            <div class="recent-orders">
                <h2>Recent Orders</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Orders</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Payment Status</th>
                                <th>Total</th>
                            </tr>
                            
                        </thead>
                        <tbody>
                            {% for o in order_list %}
                            <tr>
                                <td>INVOICE_NO-{{o.id}}</td>
                                <td>{{o.order_date}}</td>
                                <td>{{o.product_status|title}}</td>
                                {% if o.paid_status == True %}
                                <td><i class="fas fa-check-circle text-success"></i></td>
                                {% else %}
                                <td class="text-danger"><strong>X</strong></td>
                                {% endif %}
                                <td>{{o.price|floatformat:2|intcomma}}</td>
                                <td><a href="{% url 'core:order-detail' o.id %}" class="primary">View</a></td>
                                {% comment %} <td><a href="{% url 'core:order-detail' o.id %}" class="btn-small d-block">View</a></td>

                                <td class="warning">Pending</td>
                                <td class="primary">Details</td> {% endcomment %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% comment %} <a href="#"  id="show-all-orders">Show All</a> <!-- self suggestion doblehin ung page--> {% endcomment %}
                <div class="table-container">
                    <table>
                    <!-- here is where we will put the canvas, also include JS code to your response --> 
                        <canvas style="height:50px;" id="adminChart"></canvas>
                        <script>
                            const adminLabels = {{ month|safe }};
                            
                            const adminData = {
                                labels: adminLabels,
                                datasets: [{
                                    label: 'Total orders in each month',
                                    backgroundColor: 'rgb(59, 183, 126)',
                                    borderColor: 'rgb(59, 183, 126)',
                                    data: {{ total_orders|safe }}
                                }],
                            };
                        
                            const adminConfig = {
                                type: 'bar',
                                data: adminData,
                                options: {
                                    tooltips: { enabled: false },
                                    hover: { mode: null },
                                }
                            };
                        
                            const adminChart = new Chart(
                                document.getElementById('adminChart'),
                                adminConfig
                            );
                        </script>
                    </table>
                    
                </div>

                <div class="table-container">
                    <table>
                        <canvas style="height:50px;" id="adminCategoryChart"></canvas>
                        <script>
                            const categoryLabels = {{ category_labels|safe }};
                            
                            const categoryData = {
                                labels: categoryLabels,
                                datasets: [{
                                    label: 'Orders by Category',
                                    backgroundColor: [
                                        'rgb(255, 99, 132)',
                                        'rgb(255, 205, 86)',
                                        'rgb(54, 162, 235)',
                                        // Add more colors as needed
                                    ],
                                    borderColor: 'white',
                                    borderWidth: 2,
                                    data: {{ category_data|safe }}
                                }]
                            };

                            const categoryConfig = {
                                type: 'pie',
                                data: categoryData,
                                label: 'Orders by Category',
                                options: {
                                    tooltips: {
                                        callbacks: {
                                            label: function (tooltipItem, data) {
                                                return data.labels[tooltipItem.index] + ': ' + data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                                            }
                                        }
                                    },
                                    hover: { mode: null },
                                }
                            };

                            const categoryChart = new Chart(
                                document.getElementById('adminCategoryChart'),
                                categoryConfig
                            );
                        </script>

                    </table>
                </div>

            </div>
        </main>

        {% endblock content %}
